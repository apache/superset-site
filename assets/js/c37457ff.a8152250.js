"use strict";(self.webpackChunkdocs_v_2=self.webpackChunkdocs_v_2||[]).push([[7044],{92816:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var n=i(74848),r=i(28453);const t={title:"Docker Builds",hide_title:!0,sidebar_position:6,version:1},d="Docker builds, images and tags",l={id:"installation/docker-builds",title:"Docker Builds",description:"The Apache Superset community extensively uses Docker for development, release,",source:"@site/docs/installation/docker-builds.mdx",sourceDirName:"installation",slug:"/installation/docker-builds",permalink:"/docs/installation/docker-builds",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/superset/edit/master/docs/docs/installation/docker-builds.mdx",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Docker Builds",hide_title:!0,sidebar_position:6,version:1},sidebar:"CustomSidebar",previous:{title:"Upgrading Superset",permalink:"/docs/installation/upgrading-superset"},next:{title:"Configuring Superset",permalink:"/docs/configuration/configuring-superset"}},o={},a=[{value:"Build presets",id:"build-presets",level:2},{value:"Key tags examples",id:"key-tags-examples",level:2},{value:"Key ARGs in Dockerfile",id:"key-args-in-dockerfile",level:2},{value:"Caching",id:"caching",level:2},{value:"About database drivers",id:"about-database-drivers",level:2},{value:"On supporting different platforms (namely arm64 AND amd64)",id:"on-supporting-different-platforms-namely-arm64-and-amd64",level:2},{value:"Working with Apple silicon",id:"working-with-apple-silicon",level:3}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"docker-builds-images-and-tags",children:"Docker builds, images and tags"})}),"\n",(0,n.jsx)(s.p,{children:"The Apache Superset community extensively uses Docker for development, release,\nand productionizing Superset. This page details our Docker builds and tag naming\nschemes to help users navigate our offerings."}),"\n",(0,n.jsxs)(s.p,{children:["Images are built and pushed to the ",(0,n.jsx)(s.a,{href:"https://hub.docker.com/r/apache/superset",children:"Superset Docker Hub repository"})," using GitHub Actions.\nDifferent sets of images are built and/or published at different times:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Published releases"})," (",(0,n.jsx)(s.code,{children:"release"}),"): published using\ntags like ",(0,n.jsx)(s.code,{children:"3.0.0"})," and the ",(0,n.jsx)(s.code,{children:"latest"})," tag."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Pull request iterations"})," (",(0,n.jsx)(s.code,{children:"pull_request"}),"): for each pull request, while\nwe actively build the docker to validate the build, we do\nnot publish those images for security reasons, we simply ",(0,n.jsx)(s.code,{children:"docker build --load"})]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.strong,{children:"Merges to the main branch"})," (",(0,n.jsx)(s.code,{children:"push"}),"): resulting in new SHAs, with tags\nprefixed with ",(0,n.jsx)(s.code,{children:"master"})," for the latest ",(0,n.jsx)(s.code,{children:"master"})," version."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"build-presets",children:"Build presets"}),"\n",(0,n.jsx)(s.p,{children:'We have a set of build "presets" that each represent a combination of\nparameters for the build, mostly pointing to either different target layer\nfor the build, and/or base image.'}),"\n",(0,n.jsxs)(s.p,{children:["Here are the build presets that are exposed through the ",(0,n.jsx)(s.code,{children:"build_docker.py"})," script:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"lean"}),": The default Docker image, including both frontend and backend. Tags\nwithout a build_preset are lean builds (ie: ",(0,n.jsx)(s.code,{children:"latest"}),", ",(0,n.jsx)(s.code,{children:"4.0.0"}),", ",(0,n.jsx)(s.code,{children:"3.0.0"}),", ...). ",(0,n.jsx)(s.code,{children:"lean"}),"\nbuilds do not contain database\ndrivers, meaning you need to install your own. That applies to analytics databases ",(0,n.jsx)(s.strong,{children:"AND\nthe metadata database"}),". You'll likely want to layer either ",(0,n.jsx)(s.code,{children:"mysqlclient"})," or ",(0,n.jsx)(s.code,{children:"psycopg2-binary"}),"\ndepending on the metadata database you choose for your installation, plus the required\ndrivers to connect to your analytics database(s)."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dev"}),": For development, with a headless browser, dev-related utilities and root access. This\nincludes some commonly used database drivers like ",(0,n.jsx)(s.code,{children:"mysqlclient"}),", ",(0,n.jsx)(s.code,{children:"psycopg2-binary"})," and\nsome other used for development/CI"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"py311"}),", e.g., Py311: Similar to lean but with a different Python version (in this example, 3.11)."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"ci"}),": For certain CI workloads."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"websocket"}),": For Superset clusters supporting advanced features."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"dockerize"}),": Used by Helm."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"key-tags-examples",children:"Key tags examples"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"latest"}),": The latest official release build"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"latest-dev"}),": the ",(0,n.jsx)(s.code,{children:"-dev"})," image of the latest official release build, with a\nheadless browser and root access."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"master"}),": The latest build from the ",(0,n.jsx)(s.code,{children:"master"})," branch, implicitly the lean build\npreset"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"master-dev"}),": Similar to ",(0,n.jsx)(s.code,{children:"master"})," but includes a headless browser and root access."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"pr-5252"}),": The latest commit in PR 5252."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"30948dc401b40982cb7c0dbf6ebbe443b2748c1b-dev"}),": A build for\nthis specific SHA, which could be from a ",(0,n.jsx)(s.code,{children:"master"})," merge, or release."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"websocket-latest"}),": The WebSocket image for use in a Superset cluster."]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["For insights or modifications to the build matrix and tagging conventions,\ncheck the ",(0,n.jsx)(s.a,{href:"https://github.com/apache/superset/blob/master/scripts/build_docker.py",children:"build_docker.py"}),"\nscript and the ",(0,n.jsx)(s.a,{href:"https://github.com/apache/superset/blob/master/.github/workflows/docker.yml",children:"docker.yml"}),"\nGitHub action."]}),"\n",(0,n.jsx)(s.h2,{id:"key-args-in-dockerfile",children:"Key ARGs in Dockerfile"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"BUILD_TRANSLATIONS"}),": whether to build the translations into the image. For the\nfrontend build this tells webpack to strip out all locales other than ",(0,n.jsx)(s.code,{children:"en"})," from\nthe ",(0,n.jsx)(s.code,{children:"moment-timezone"})," library. For the backendthis skips compiling the\n",(0,n.jsx)(s.code,{children:"*.po"})," translation files"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"DEV_MODE"}),": whether to skip the frontend build, this is used by our ",(0,n.jsx)(s.code,{children:"docker-compose"})," dev setup\nwhere we mount the local volume and build using ",(0,n.jsx)(s.code,{children:"webpack"})," in ",(0,n.jsx)(s.code,{children:"--watch"})," mode, meaning as you\nalter the code in the local file system, webpack, from within a docker image used for this\npurpose, will constantly rebuild the frontend as you go. This ARG enables the initial\n",(0,n.jsx)(s.code,{children:"docker-compose"})," build to take much less time and resources"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"INCLUDE_CHROMIUM"}),': whether to include chromium in the backend build so that it can be\nused as a headless browser for workloads related to "Alerts & Reports" and thumbnail generation']}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"INCLUDE_FIREFOX"}),": same as above, but for firefox"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"PY_VER"}),": specifying the base image for the python backend, we don't recommend altering\nthis setting if you're not working on forwards or backwards compatibility"]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"caching",children:"Caching"}),"\n",(0,n.jsxs)(s.p,{children:["To accelerate builds, we follow Docker best practices and use ",(0,n.jsx)(s.code,{children:"apache/superset-cache"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"about-database-drivers",children:"About database drivers"}),"\n",(0,n.jsx)(s.p,{children:"Our docker images come with little to zero database driver support since\neach environment requires different drivers, and maintaining a build with\nwide database support would be both challenging (dozens of databases,\npython drivers, and os dependencies) and inefficient (longer\nbuild times, larger images, lower layer cache hit rate, ...)."}),"\n",(0,n.jsxs)(s.p,{children:["For production use cases, we recommend that you derive our ",(0,n.jsx)(s.code,{children:"lean"})," image(s) and\nadd database support for the database you need."]}),"\n",(0,n.jsx)(s.h2,{id:"on-supporting-different-platforms-namely-arm64-and-amd64",children:"On supporting different platforms (namely arm64 AND amd64)"}),"\n",(0,n.jsxs)(s.p,{children:["Currently all automated builds are multi-platform, supporting both ",(0,n.jsx)(s.code,{children:"linux/arm64"}),"\nand ",(0,n.jsx)(s.code,{children:"linux/amd64"}),". This enables higher level constructs like ",(0,n.jsx)(s.code,{children:"helm"})," and\n",(0,n.jsx)(s.code,{children:"docker compose"})," to point to these images and effectively be multi-platform\nas well."]}),"\n",(0,n.jsxs)(s.p,{children:["Pull requests and master builds\nare one-image-per-platform so that they can be parallelized and the\nbuild matrix for those is more sparse as we don't need to build every\nbuild preset on every platform, and generally can be more selective here.\nFor those builds, we suffix tags with ",(0,n.jsx)(s.code,{children:"-arm"})," where it applies."]}),"\n",(0,n.jsx)(s.h3,{id:"working-with-apple-silicon",children:"Working with Apple silicon"}),"\n",(0,n.jsxs)(s.p,{children:["Apple's current generation of computers uses ARM-based CPUs, and Docker\nrunning on MACs seem to require ",(0,n.jsx)(s.code,{children:"linux/arm64/v8"})," (at least one user's M2 was\nconfigured in that way). Setting the environment\nvariable ",(0,n.jsx)(s.code,{children:"DOCKER_DEFAULT_PLATFORM"})," to ",(0,n.jsx)(s.code,{children:"linux/amd64"})," seems to function in\nterm of leveraging, and building upon the Superset builds provided here."]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"export DOCKER_DEFAULT_PLATFORM=linux/amd64\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Presumably, ",(0,n.jsx)(s.code,{children:"linux/arm64/v8"})," would be more optimized for this generation\nof chips, but less compatible across the ARM ecosystem."]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>d,x:()=>l});var n=i(96540);const r={},t=n.createContext(r);function d(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);